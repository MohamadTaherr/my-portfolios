version: "1"

projects:
  - name: portfolio-backend
    environments:
      - name: Production
        services:
          - type: web
            name: portfolio-backend
            runtime: node
            plan: free
            region: frankfurt
            buildCommand: pnpm install && pnpm --filter backend run db:generate && pnpm --filter backend run build
            startCommand: pnpm --filter backend run start
            healthCheckPath: /health
            autoDeployTrigger: commit
            envVars:
              - key: NODE_ENV
                value: production
              - key: PORT
                value: 10000
              - key: FRONTEND_URL
                sync: false
              - key: ADMIN_PASSWORD
                generateValue: true
              - key: DATABASE_URL
                fromDatabase:
                  name: portfolio-db
                  property: connectionString
        databases:
          - name: portfolio-db
            databaseName: portfolio_db
            user: portfolio_user
            plan: free
            region: frankfurt
            ipAllowList:
              - source: 0.0.0.0/0
                description: everywhere
            postgresMajorVersion: "17"

