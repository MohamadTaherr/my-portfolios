version: "1"

projects:
  - name: portfolio-backend
    environments:
      - name: Production
        services:
          - type: web
            name: portfolio-backend
            runtime: node
            plan: free
            region: frankfurt
            buildCommand: pnpm install && pnpm --filter backend run db:push && pnpm --filter backend run db:generate && pnpm --filter backend run build
            startCommand: pnpm --filter backend run db:push && pnpm --filter backend run start
            healthCheckPath: /health
            autoDeployTrigger: commit
            envVars:
              - key: NODE_ENV
                value: production
              - key: PORT
                value: 10000
              - key: BACKEND_URL
                value: https://portfolio-backend-9i6h.onrender.com
              - key: FRONTEND_URL
                value: http://localhost:3000,https://my-portfolios-studio.vercel.app
              - key: ADMIN_PASSWORD
                value: admin
              - key: DATABASE_URL
                fromDatabase:
                  name: portfolio-db
                  property: connectionString
              - key: BACKBLAZE_BUCKET_ID
                value: b2469a1e1eeea86199ae0813
              - key: BACKBLAZE_BUCKET_NAME
                value: myportfolioedmond
              - key: BACKBLAZE_KEY_ID
                sync: false
              - key: BACKBLAZE_APPLICATION_KEY
                sync: false
        databases:
          - name: portfolio-db
            databaseName: portfolio_db
            user: portfolio_user
            plan: free
            region: frankfurt
            ipAllowList:
              - source: 0.0.0.0/0
                description: everywhere
            postgresMajorVersion: "17"

